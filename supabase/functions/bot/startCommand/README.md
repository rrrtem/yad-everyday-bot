# StartCommand Module Architecture

–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥—ã `/start` –≤ Telegram –±–æ—Ç–µ.

## üìä –î–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

```mermaid
graph TD
    A["üì± index.ts<br/>(main entry point)"] --> B["üîÑ startCommand/index.ts<br/>(main router)"]
    C["‚öôÔ∏è commandHandler.ts"] --> B
    D["üß™ startTest.ts"] --> B
    
    B --> E["üîç UserAnalyzer"]
    E --> F{"User Type?"}
    
    F -->|new_user| G["üìù NewUserFlow"]
    F -->|active_user| H["‚úÖ ActiveUserFlow"]
    F -->|continue_setup| I["üîÑ ContinueSetupFlow"]
    F -->|returning_user| J["üëã ReturningUserFlow"]
    F -->|in_waitlist| P["‚è≥ WaitlistFlow"]
    
    G --> Q{"Slots Available?"}
    Q -->|Yes| K["‚öôÔ∏è SetupProcess"]
    Q -->|No| P
    
    J --> K
    I --> K
    
    K --> L["üéØ StateHandlers"]
    L --> M["üìù ModeSelectionHandler"]
    L --> N["üé´ PromoCodeHandler"]
    
    M --> O["üí≥ PaymentHandler"]
    N --> O
    
    style B fill:#e8f5e8
    style E fill:#fff3e0
    style K fill:#f3e5f5
    style L fill:#e3f2fd
    style O fill:#f1f8e9
    style P fill:#ffe0e0
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
startCommand/
‚îú‚îÄ‚îÄ README.md                   # üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îú‚îÄ‚îÄ index.ts                    # üîÑ –ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä
‚îú‚îÄ‚îÄ UserAnalyzer.ts             # üîç –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ flows/                      # üìã Flows –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ NewUserFlow.ts          # üìù –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ ActiveUserFlow.ts       # ‚úÖ –£–∂–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ ReturningUserFlow.ts    # üëã –í–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ ContinueSetupFlow.ts    # üîÑ –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ WaitlistFlow.ts         # ‚è≥ –°–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è
‚îî‚îÄ‚îÄ states/                     # ‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π
    ‚îú‚îÄ‚îÄ index.ts                # üéØ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    ‚îú‚îÄ‚îÄ SetupProcess.ts         # ‚öôÔ∏è –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    ‚îú‚îÄ‚îÄ ModeSelectionHandler.ts # üìù –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
    ‚îú‚îÄ‚îÄ PromoCodeHandler.ts     # üé´ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
    ‚îî‚îÄ‚îÄ PaymentHandler.ts       # üí≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
`UserAnalyzer` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- **new_user** - –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤ –ë–î –Ω–æ –Ω–æ–≤—ã–π –¥–ª—è —á–∞—Ç–∞
- **active_user** - —É–∂–µ –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (in_chat = true)
- **continue_setup** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (user_state != null)
- **returning_user** - –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (joined_at != null)
- **in_waitlist** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–ø–∏—Å–∫–µ –æ–∂–∏–¥–∞–Ω–∏—è (waitlist = true)

### 2. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è Flow
–ì–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä (`index.ts`) –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É Flow:

#### NewUserFlow
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç (AVAILABLE_SLOTS)
- –ï—Å–ª–∏ –º–µ—Å—Ç –Ω–µ—Ç - –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ WaitlistFlow
- –ï—Å–ª–∏ –µ—Å—Ç—å - –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞

#### ActiveUserFlow  
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω

#### ReturningUserFlow
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–Ω–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- –ù–∞–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —á–∞—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–Ω–∏) –∏–ª–∏ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É

#### ContinueSetupFlow
- –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞ –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è: waiting_mode, waiting_promo, payment_link_sent

#### WaitlistFlow
- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫ –æ–∂–∏–¥–∞–Ω–∏—è
- –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –≤ –æ—á–µ—Ä–µ–¥–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–µ –≤ –æ—á–µ—Ä–µ–¥—å

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π
`StateHandlers` —É–ø—Ä–∞–≤–ª—è—é—Ç –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏:

#### SetupProcess
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î

#### ModeSelectionHandler
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (text)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–∏—Ç–º daily
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ–ø–ª–∞—Ç—ã

#### PromoCodeHandler
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥—ã
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–ª—É–±–∞

#### PaymentHandler
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–ª—É–±–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–Ω–∏
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É

## üö¶ –°–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ (Waitlist)

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- `AVAILABLE_SLOTS` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç (0 = –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)

### –ü–æ–ª—è –≤ –ë–î
- `waitlist` (boolean) - –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–ø–∏—Å–∫–µ –æ–∂–∏–¥–∞–Ω–∏—è
- `waitlist_position` (integer) - –ø–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏
- `waitlist_added_at` (timestamp) - –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ waitlist
- `user_state` = 'in_waitlist' - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ waitlist

### –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
- `/open[—á–∏—Å–ª–æ]` - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç
  - –ü—Ä–∏–º–µ—Ä: `/open10` - –æ—Ç–∫—Ä–æ–µ—Ç 10 –º–µ—Å—Ç
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ waitlist
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–ª—è –Ω–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –ü—Ä–∏ `/start` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö >= AVAILABLE_SLOTS, –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ waitlist
3. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–æ–≤—ã—Ö –º–µ—Å—Ç –ø–µ—Ä–≤—ã–µ N –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ waitlist –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. –î–ª—è –Ω–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É
2. **–õ–µ–≥–∫–æ —á–∏—Ç–∞–µ—Ç—Å—è** - –ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ  
3. **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
4. **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
5. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∏–º–ø–æ—Ä—Ç—ã –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –∫ –Ω—É–∂–Ω—ã–º –º–æ–¥—É–ª—è–º
6. **–ì–∏–±–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º** - –ª–µ–≥–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìù –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (–ø–æ logic.md)

–ú–æ–¥—É–ª—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É **A1. /start ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏–∑ `logic.md`:

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è** - UserAnalyzer
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è Flow  
3. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Flow
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç** - WaitlistFlow.shouldAddToWaitlist()
5. **–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞** - SetupProcess + ModeSelectionHandler
6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∏—Ç–º–∞** - daily –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
7. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã** - PaymentHandler

## üìà –£–ø—Ä–æ—â–µ–Ω–∏—è –≤ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏

- **–£–±—Ä–∞–Ω –≤—ã–±–æ—Ä —Ä–∏—Ç–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è `daily` –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- **–û—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ ChangePace** - –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∏—Ç–º –ø–æ–∑–∂–µ
- **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–ª–æ—É** - —Ä–µ–∂–∏–º ‚Üí –æ–ø–ª–∞—Ç–∞ (–±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ä–∏—Ç–º–∞)
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ waitlist

## üîß –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

–í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ `/supabase/functions/constants.ts`:
- MSG_WELCOME, MSG_WELCOME_ALREADY_ACTIVE - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- MSG_MODE - –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
- MSG_PROMO, MSG_PROMO_ERR - –ø—Ä–æ–º–æ–∫–æ–¥—ã
- MSG_LINK_CLUB, MSG_LINK_STANDARD - —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É
- MSG_WAITLIST, MSG_WAITLIST_OPENED - —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è waitlist
- AVAILABLE_MODES - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã
- AVAILABLE_PACES.DAILY - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ–º—ã–π —Ä–∏—Ç–º
- VALID_PROMO_CODES - –≤–∞–ª–∏–¥–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
- AVAILABLE_SLOTS - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç

## üì• –ò–º–ø–æ—Ä—Ç—ã

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è:

```typescript
// –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
import { handleStartCommand, handleStartCallbackQuery } from "./startCommand/index.ts";

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π  
import { handleModeSelection, handlePromoCode, handleNoPromo } from "./startCommand/states/index.ts";
```

## üé´ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

### –¢–∏–ø—ã –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

1. **CLUB2024** - –î–∞–µ—Ç —Å–∫–∏–¥–∫—É –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–ª—É–±–∞
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `club = true` –≤ –ë–î
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É —Å–æ —Å–∫–∏–¥–∫–æ–π

2. **FREE30** - –î–∞–µ—Ç 30 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –¥–Ω–µ–π —É—á–∞—Å—Ç–∏—è
   - –ù–∞—á–∏—Å–ª—è–µ—Ç `subscription_days_left = 30` –≤ –ë–î
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –≤—Ö–æ–¥ –≤ —á–∞—Ç –±–µ–∑ –æ–ø–ª–∞—Ç—ã

### –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```typescript
// –í PromoCodeHandler.ts
if (promoType === PROMO_TYPES.CLUB_DISCOUNT) {
  await this.handleClubDiscountPromo(telegramId, promoCode);
} else if (promoType === PROMO_TYPES.FREE_DAYS) {
  await this.handleFreeDaysPromo(telegramId, promoCode);
}
```

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

- `VALID_PROMO_CODES` - –º–∞—Å—Å–∏–≤ –≤–∞–ª–∏–¥–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- `PROMO_TYPES` - —Ç–∏–ø—ã –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∫–æ–¥–∞–º–∏
- `FREE_PROMO_DAYS` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è FREE30 (30)
- `MSG_FREE_PROMO_SUCCESS` - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ FREE30

### –§–ª–æ—É –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –ø—Ä–æ–º–æ–∫–æ–¥
2. `PromoCodeHandler.handlePromoCode()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
3. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥:
   - `handleClubDiscountPromo()` - –¥–ª—è CLUB2024
   - `handleFreeDaysPromo()` - –¥–ª—è FREE30
4. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

- **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞
- **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏** - –∫–∞–∂–¥—ã–π —Ç–∏–ø –ø—Ä–æ–º–æ–∫–æ–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –≤—Å–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É
2. **–õ–µ–≥–∫–æ —á–∏—Ç–∞–µ—Ç—Å—è** - –ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ  
3. **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
4. **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
5. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∏–º–ø–æ—Ä—Ç—ã –∏–¥—É—Ç –Ω–∞–ø—Ä—è–º—É—é –∫ –Ω—É–∂–Ω—ã–º –º–æ–¥—É–ª—è–º
6. **–ì–∏–±–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º** - –ª–µ–≥–∫–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìù –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (–ø–æ logic.md)

–ú–æ–¥—É–ª—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É **A1. /start ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –∏–∑ `logic.md`:

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è** - UserAnalyzer
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è Flow  
3. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π Flow
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç** - WaitlistFlow.shouldAddToWaitlist()
5. **–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞** - SetupProcess + ModeSelectionHandler
6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∏—Ç–º–∞** - daily –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
7. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã** - PaymentHandler

## üìà –£–ø—Ä–æ—â–µ–Ω–∏—è –≤ —Å—Ç–∞—Ä—Ç–æ–≤–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏

- **–£–±—Ä–∞–Ω –≤—ã–±–æ—Ä —Ä–∏—Ç–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è `daily` –¥–ª—è –≤—Å–µ—Ö —Ä–µ–∂–∏–º–æ–≤
- **–û—Ç–¥–µ–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ ChangePace** - –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∏—Ç–º –ø–æ–∑–∂–µ
- **–£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–ª–æ—É** - —Ä–µ–∂–∏–º ‚Üí –æ–ø–ª–∞—Ç–∞ (–±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ä–∏—Ç–º–∞)
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ waitlist

## üîß –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

–í—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ `/supabase/functions/constants.ts`:
- MSG_WELCOME, MSG_WELCOME_ALREADY_ACTIVE - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
- MSG_MODE - –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞
- MSG_PROMO, MSG_PROMO_ERR - –ø—Ä–æ–º–æ–∫–æ–¥—ã
- MSG_LINK_CLUB, MSG_LINK_STANDARD - —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É
- MSG_WAITLIST, MSG_WAITLIST_OPENED - —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è waitlist
- AVAILABLE_MODES - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∂–∏–º—ã
- AVAILABLE_PACES.DAILY - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞–µ–º—ã–π —Ä–∏—Ç–º
- VALID_PROMO_CODES - –≤–∞–ª–∏–¥–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
- AVAILABLE_SLOTS - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Å—Ç

## üì• –ò–º–ø–æ—Ä—Ç—ã

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª—è:

```typescript
// –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
import { handleStartCommand, handleStartCallbackQuery } from "./startCommand/index.ts";

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π  
import { handleModeSelection, handlePromoCode, handleNoPromo } from "./startCommand/states/index.ts";
``` 