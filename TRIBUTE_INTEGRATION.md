# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tribute API

## üìã –û–±–∑–æ—Ä

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–µ–∂–¥—É Telegram –±–æ—Ç–æ–º –∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π Tribute. –í—Å–µ webhook'–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π `/bot` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞.

## üîó URL –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**URL –¥–ª—è Tribute Dashboard:**
```
https://bqtgrzauzqlodgipaisz.supabase.co/functions/v1/bot
```

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **API –∫–ª—é—á**: –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –≤ Creator Dashboard ‚Üí Settings ‚Üí API Keys
2. **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `TRIBUTE_API_KEY` –≤ Supabase
3. **–ü–æ–¥–ø–∏—Å—å webhook'–∞**: –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É `trbt-signature`

## üì® –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è

### 1. NewSubscriptionEvent (–ë6)
- **–¢—Ä–∏–≥–≥–µ—Ä**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –Ω–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É
- **–î–µ–π—Å—Ç–≤–∏–µ**: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
- **–ë–æ–Ω—É—Å–Ω—ã–µ –¥–Ω–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ –Ω–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–µ

### 2. CancelledSubscriptionEvent (–ë7)  
- **–¢—Ä–∏–≥–≥–µ—Ä**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É
- **–î–µ–π—Å—Ç–≤–∏–µ**: –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∞

### `/sync_subscriptions`
**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —á–∞—Ç–µ (`in_chat = true`)
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç `expires_at` —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
- **–î–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫**: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `subscription_active = false`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **–î–ª—è –¥–µ–π—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫**: –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `subscription_active = true` –µ—Å–ª–∏ –±—ã–ª–æ `false`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç: –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ/–∏—Å—Ç–µ–∫—à–∏—Ö/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

**–í–∞–∂–Ω–æ**: –ö–æ–º–∞–Ω–¥–∞ –∞–¥–º–∏–Ω–∞ –º–æ–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `subscription_active` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö `expires_at`

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö –¥–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### `/tribute_test`
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç**:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å webhook URL
- –ù–∞–ª–∏—á–∏–µ `TRIBUTE_API_KEY`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç URL –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Tribute

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫

–î–ª—è –ø–æ–¥–ø–∏—Å–æ–∫, –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã—Ö –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ö–æ–º–∞–Ω–¥–∞ –∞–¥–º–∏–Ω–∞
```
/sync_subscriptions
```
–ü—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –æ–±–Ω–æ–≤–∏—Ç –∏—Å—Ç–µ–∫—à–∏–µ.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Tribute
–ü–æ–ø—Ä–æ—Å–∏—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ:
- **REST API endpoints** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
- **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Å–ª–∞—Ç—å webhook'–∏** –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–æ–∫
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API** (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–∫—Ä—ã—Ç—ã–µ endpoints)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ç–º–µ–Ω–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
‚ö†Ô∏è **–û—Å—Ç–æ—Ä–æ–∂–Ω–æ!** –¢–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
1. –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É ‚Üí –ø–æ–ª—É—á–∏—Ç—å `CancelledSubscriptionEvent`
2. –°—Ä–∞–∑—É –æ—Ñ–æ—Ä–º–∏—Ç—å –Ω–æ–≤—É—é ‚Üí –ø–æ–ª—É—á–∏—Ç—å `NewSubscriptionEvent`

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ webhook'–æ–≤

### NewSubscriptionEvent
```json
{
  "created_at": "2025-03-20T01:15:58.33246Z",
  "name": "new_subscription",
  "payload": {
    "subscription_name": "Support my art üåü",
    "subscription_id": 1644,
    "period_id": 1547,
    "period": "monthly",
    "price": 1000,
    "amount": 700,
    "currency": "eur",
    "user_id": 31326,
    "telegram_user_id": 12321321,
    "channel_id": 614,
    "channel_name": "lbs",
    "expires_at": "2025-04-20T01:15:57.305733Z"
  },
  "sent_at": "2025-03-20T01:15:58.542279448Z"
}
```

### CancelledSubscriptionEvent
```json
{
  "created_at": "2025-03-21T11:20:44.013969Z",
  "name": "cancelled_subscription",
  "payload": {
    "subscription_name": "Join the private club üéâ",
    "subscription_id": 1646,
    "period_id": 1549,
    "period": "monthly",
    "price": 1000,
    "amount": 1000,
    "currency": "eur",
    "user_id": 31326,
    "telegram_user_id": 12321321,
    "channel_id": 614,
    "channel_name": "lbs",
    "cancel_reason": "",
    "expires_at": "2025-03-20T11:13:44.737Z"
  },
  "sent_at": "2025-03-21T11:20:44.527657077Z"
}
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ Supabase Functions
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Supabase Dashboard](https://supabase.com/dashboard/project/bqtgrzauzqlodgipaisz/functions)
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `bot`
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø–∏—Å–∏ —Å `=== TRIBUTE WEBHOOK ===`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook'–æ–≤
–ö–æ–º–∞–Ω–¥–∞ `/tribute_test` –ø–æ–∫–∞–∂–µ—Ç:
- –°—Ç–∞—Ç—É—Å URL
- –ù–∞–ª–∏—á–∏–µ API –∫–ª—é—á–∞  
- URL –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Tribute

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
–ï—Å–ª–∏ webhook'–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `TRIBUTE_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ Tribute –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ API –∫–ª—é—á
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–∫–∏

## üìö –°—Å—ã–ª–∫–∏

- **[Tribute API Documentation](https://wiki.tribute.tg/for-content-creators/api-documentation)**
- **[Supabase Functions Dashboard](https://supabase.com/dashboard/project/bqtgrzauzqlodgipaisz/functions)**
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Tribute**: –ß–µ—Ä–µ–∑ Creator Dashboard

---

## üéØ –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

‚úÖ **–ì–æ—Ç–æ–≤–æ**: Webhook'–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ **–ì–æ—Ç–æ–≤–æ**: –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ**: –ù–µ—Ç REST API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫  
üìÖ **–ü–ª–∞–Ω—ã**: –ó–∞–ø—Ä–æ—Å–∏—Ç—å —É Tribute –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é REST API 