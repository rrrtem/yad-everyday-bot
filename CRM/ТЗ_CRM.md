# Техническое задание: CRM-страница пользователей (админка)

## 1. Цель
Создать современную, минималистичную и защищённую веб-страницу для просмотра и фильтрации всех пользователей из базы данных Supabase. Страница предназначена для внутреннего использования (админка), размещается на Supabase Hosting.

---

## 2. Технологии
- **Frontend:** Next.js 14 + TypeScript
- **UI:** Radix UI (headless-компоненты) + Tailwind CSS (стилизация)
- **API:** Supabase JS SDK (только чтение, сервисный ключ не хранить в публичном репозитории)
- **Аутентификация:** Простая форма логина/пароля на фронте (localStorage)
- **Деплой:** Supabase Hosting

---

## 3. Функционал

### 3.1. Аутентификация
- Страница логина (логин/пароль)
- После успешного входа — доступ к CRM, иначе редирект на логин
- Токен/флаг авторизации хранится в localStorage

### 3.2. Главная страница
- Список всех пользователей из Supabase
- **Фильтры:**
  - В чате (`in_chat = true`)
  - Был в чате, но вышел (`in_chat = false` и `joined_at IS NOT NULL`)
  - Никогда не был в чате (`joined_at IS NULL`)
  - Поиск по username/ID
- Сортировка по дате регистрации, активности, дням до окончания подписки
- Адаптивность (мобильные/десктоп)

### 3.3. Карточка пользователя (UserCard)
В карточке отображаются ключевые поля:
- Telegram ID (`telegram_id`)
- Имя, фамилия, username (`first_name`, `last_name`, `username`)
- В чате сейчас (`in_chat`)
- Дата входа/выхода из чата (`joined_at`, `left_at`)
- Активна ли подписка (`subscription_active`)
- Осталось дней подписки (`subscription_days_left`)
- Дата окончания подписки (`expires_at`)
- Дата регистрации (`created_at`)
- Количество страйков (`strikes_count`)
- Пост сегодня (`post_today`)
- Последний пост (`last_post_date`)
- Всего постов (`units_count`)
- Пауза (`pause_started_at`, `pause_until`, `pause_days`)
- Режим (`mode`)
- Ритм (`pace`)
- Публичные напоминания (`public_remind`)
- Промокод (`promo_code`)
- Статус клуба (`club`)
- Позиция в waitlist (`waitlist`, `waitlist_position`)
- Последняя активность (`last_activity_at`)

---

## 4. UI/UX
- Современный минималистичный дизайн (Radix UI + Tailwind CSS)
- Чистая типографика, много whitespace, акцент на данные
- Карточки пользователей с детальной информацией
- Фильтры и поиск всегда доступны
- Возможность быстро посмотреть детали пользователя
- Все текстовые константы вынесены в `constants.ts`

---

## 5. Безопасность
- Не хранить сервисный ключ Supabase в публичном репозитории!
- Доступ к CRM только после авторизации
- Использование публичного анонимного ключа с RLS настройками

---

## 6. Деплой
- Сборка Next.js (`npm run build`)
- Деплой на Supabase Hosting или Vercel
- Настройка переменных окружения через интерфейс платформы

---

## 7. Структура проекта (Next.js App Router)

```
/CRM
  /src
    /app
      /api/users          - API route для работы с пользователями
      /dashboard          - Главная страница CRM
      /login              - Страница аутентификации
      - layout.tsx        - Главный лейаут
      - page.tsx          - Корневая страница (редирект)
      - globals.css       - Глобальные стили
    /components
      - LoginForm.tsx     - Форма входа
      - UserCard.tsx      - Карточка пользователя
      - Filters.tsx       - Фильтры пользователей
      - UserList.tsx      - Список пользователей
    /lib
      - supabase.ts       - Клиент Supabase
    - constants.ts        - Все настройки и константы проекта
  - package.json
  - next.config.js        - Конфигурация Next.js
  - tailwind.config.js    - Конфигурация Tailwind
  - tsconfig.json         - Конфигурация TypeScript
  - supabase/config.toml  - Конфигурация для деплоя
```

---

## 8. Ключевые изменения по сравнению с Vite версией

### 8.1. Технологические изменения
- **Next.js App Router** вместо React Router
- **API Routes** вместо прямых запросов к Supabase с фронтенда
- **Supabase Hosting** вместо GitHub Pages
- **Централизованные константы** - все настройки в `constants.ts`

### 8.2. Улучшения архитектуры
- Строгая типизация через TypeScript интерфейсы
- Модульная структура с четким разделением ответственности
- Централизованное управление стилями и сообщениями
- Улучшенная обработка ошибок и состояний загрузки

### 8.3. Следование правилам проекта
- Все настройки вынесены в `constants.ts` по группам функций
- Все текстовые сообщения централизованы
- Соблюдение логики проекта из `/supabase/functions/logic.md`

---

## 9. Примечания
- Все фильтры и поля легко расширяемы через `constants.ts`
- UI максимально простой для чтения и управления
- Вся логика фильтрации и отображения — на фронте, данные берём из Supabase через API Routes
- Готовность к переводу на другие языки благодаря централизованным константам 